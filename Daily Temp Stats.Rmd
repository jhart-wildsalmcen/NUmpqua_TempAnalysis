---
title: "Daily Temp Stats"
author: "J.Hart"
date: "2025-01-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


For each stream temperature site (including USGS sites and our temperature logger sites), please summarize:
1) maximum daily maximum stream temperature (ie, just the warmest temperature recorded at each site).
2) the number of days where daily maximums exceeded 20 C.
3) linear regressions of daily maximum stream temperatures on daily maximum air temperatures for the June 1 -  Aug 30 period. Use the air temperature data from the NorthUmpAtSteamboat site  (logger # 21679162). We will want to take the slope coefficients and R squared values from each regression. 

I think we should summarize all this in a table in the manuscript, so providing the info in excel table form is the easiest for me to deal with. I also think it would be good to output plots for all of the air stream temperature regressions to visually check for fit and outliers, etc.. Right now I would envision this as supplementary material, but not necessarily in the main manuscript.


```{r}
# Load packages

library(tidyverse)
library(readxl)
library(janitor)
library(writexl)

```


```{r}
# Read in logger metadata
log_metadata <- read_xlsx("NUmpTemperature2024.xlsx") %>% 
 clean_names()

logger_loc <- log_metadata %>% 
  select(logger_id, lat, long)

logger_site <- log_metadata %>% 
  select(logger_id, site)

mat = matrix(ncol = 0, nrow = 0) 
daily_air_master = data.frame(mat)
daily_water_master = data.frame(mat)

temp <- read_xlsx("2024 Logger Sites/Water/21679182.xlsx") %>% 
 clean_names() %>% 
 mutate(logger_id = "21679182",
        type = "Water") %>% 
 select(-number) %>% 
 rename("date"= "date_time_pdt",
        "temp_c"= "temperature_c") %>% 
 separate('date',
          into = c('longdate', 'time'),
          sep= ' ') %>% 
 separate('longdate',
                  into = c('year', 'month', 'day'),
                  sep= '-',
                  remove = FALSE) 

temp <- merge(temp, logger_loc, by="logger_id") 

daily_temp_stats <- temp %>%
  group_by(logger_id, type, year, month, day, longdate, lat, long) %>%
  summarise(mean_temp = round(mean(temp_c), digits=2),
            min_temp = round(min(temp_c), digits=2),
            max_temp = round(max(temp_c), digits=2))
  
  
# daily_air_master <- rbind(daily_air_master, daily_temp_stats)
daily_water_master <- rbind(daily_water_master, daily_temp_stats)

  write_xlsx(daily_air_master, "2024 Logger Sites/Air/daily_air_master.xlsx")
  write_xlsx(daily_water_master, "2024 Logger Sites/Water/daily_water_master.xlsx")
```


```{r}
# Review prelim daily air temp plots
a <- ggplot(data = daily_air_master, aes(x = as.Date(longdate), y = mean_temp)) + geom_line()
a + facet_wrap(~logger_id)

# Review prelim daily water temp plots
w <- ggplot(data = daily_water_master, aes(x = as.Date(longdate), y = mean_temp)) + geom_line()
w + facet_wrap(~logger_id)
```


```{r}
daily_air_master <- merge(daily_air_master, logger_site, by="logger_id") 
daily_water_master <- merge(daily_water_master, logger_site, by="logger_id") 
```


```{r}
temp <- read_xlsx("USGS Sites/USGS Site 14317450 (Idleyld Park).xlsx") %>% 
 clean_names() %>% 
 mutate(type = "Water") %>% 
rename("longdate" = "datetime",
       "mean_temp" = "mean_c",
       "min_temp" = "min_c",
       "max_temp" = "max_c") %>% 
separate('longdate',
                  into = c('year', 'month', 'day'),
                  sep= '-',
                  remove = FALSE) 

temp <- merge(temp, logger_site, by="logger_id")

daily_water_master <- rbind(temp, daily_water_master)
```

```{r}
MDMS <- daily_water_master %>% 
  filter(longdate > "2024-06-19" & longdate <= "2024-09-15") %>% 
  group_by(logger_id, site) %>% 
  summarize(mdms = max(max_temp))
```

